# Plan B: MACL Rescue æ‰§è¡ŒæŒ‡å—

## ğŸš¨ å½“å‰çŠ¶æ€
- **è§¦å‘æ¡ä»¶**: Resumeè®­ç»ƒEpoch 5 mAP=0.53 (ä½äº0.55é˜ˆå€¼)
- **å¤±è´¥æ¨¡å¼**: Pure Detectionæ¨¡å¼æŒç»­4ä¸ªepochæœªæ¢å¤ (0.5884â†’0.53)
- **æ ¹æœ¬åŸå› **: Catastrophic Forgetting (LLVIPâ†’KAISTç‰¹å¾ç©ºé—´æ¼‚ç§»)

## ğŸ¯ Plan B æ ¸å¿ƒç­–ç•¥

### **ç»„åˆæ–¹æ¡ˆ: Ultra-Low LR + Lightweight MACL**

```
Option A: è¶…ä½å­¦ä¹ ç‡
- lr=1e-5 (åŸæ¥4e-5çš„1/4)
- backbone lr=5e-7 (æä¿å®ˆ,lr_mult=0.05)
- ç›®æ ‡: é¿å…ç‰¹å¾éœ‡è¡,ç²¾ç»†è°ƒæ•´

Option D: è½»é‡çº§MACL
- lambda1=0.005 (åŸæ¥0.05çš„1/10)
- æ¸è¿›å¼å¢é•¿: 0.005â†’0.0075â†’0.01125
- ç›®æ ‡: é‡å»ºLLVIP-KAISTè¯­ä¹‰ä¸€è‡´æ€§
```

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### **Step 1: åœæ­¢å½“å‰è®­ç»ƒ** (å¦‚æœEpoch 5è¿˜åœ¨è¿è¡Œ)

```bash
# åœ¨è®­ç»ƒç»ˆç«¯æŒ‰ Ctrl+C
# æˆ–ç›´æ¥å…³é—­è®­ç»ƒçª—å£
```

### **Step 2: éªŒè¯é…ç½®æ–‡ä»¶**

æ£€æŸ¥å·²åˆ›å»ºçš„æ–‡ä»¶:
```
âœ… configs/llvip/stage2_1_kaist_planB_macl_rescue.py
âœ… configs/llvip/progressive_lambda_hook.py
âœ… work_dirs/stage2_1_pure_detection/stage2_1_backup_ep2.pth (mAP=0.5884)
```

### **Step 3: å¯åŠ¨Plan Bè®­ç»ƒ**

```bash
# åœ¨ mmdetection ç›®å½•ä¸‹æ‰§è¡Œ
python tools/train.py configs/llvip/stage2_1_kaist_planB_macl_rescue.py
```

### **Step 4: å®æ—¶ç›‘æ§**

å…³é”®æŒ‡æ ‡å˜åŒ–é¢„æœŸ:

| Epoch | Lambda1 | é¢„æœŸmAP | é¢„æœŸRecall | é¢„æœŸDets | åˆ¤æ–­ |
|-------|---------|---------|-----------|---------|------|
| **1** | 0.005 | 0.56-0.58 | 0.70+ | 10K+ | âœ… ç¨³å®š |
| **2** | 0.005 | 0.58-0.60 | 0.72+ | 11K+ | âœ… æ¢å¤ |
| **3** | 0.0075 | 0.60-0.62 | 0.74+ | 11.5K+ | âœ… çªç ´ |
| **4** | 0.0075 | 0.62-0.64 | 0.76+ | 12K+ | âœ… æˆåŠŸ |
| **5** | 0.01125 | 0.64+ | 0.78+ | 12K+ | ğŸ¯ ç›®æ ‡ |
| **6** | 0.01125 | 0.65+ | 0.80+ | 12K+ | ğŸ¯ è¶…è¶Š |

### **Step 5: å®æ—¶å‘½ä»¤ç›‘æ§**

**ç›‘æ§è®­ç»ƒè¿›åº¦**:
```powershell
# æŸ¥çœ‹æœ€æ–°æ—¥å¿— (æ¯30ç§’åˆ·æ–°)
while ($true) {
    Clear-Host
    Get-Content "work_dirs/stage2_1_planB_macl_rescue/*.log" -Tail 50 | Select-String "Epoch|mAP|lambda"
    Start-Sleep -Seconds 30
}
```

**æå–Lambdaæ›´æ–°æ—¥å¿—**:
```powershell
Get-Content "work_dirs/stage2_1_planB_macl_rescue/*.log" | Select-String "Progressive Lambda Update" -Context 3,3
```

**æå–æ‰€æœ‰mAP**:
```powershell
Get-Content "work_dirs/stage2_1_planB_macl_rescue/*.log" | Select-String "pascal_voc/mAP:"
```

## ğŸ“Š æˆåŠŸ/å¤±è´¥åˆ¤æ–­æ ‡å‡†

### âœ… **æˆåŠŸæ ‡å¿—** (Epoch 1-2å†…å‡ºç°)

1. **mAPç«‹å³å›å‡**:
   - Epoch 1: mAP â‰¥ 0.560 (ä»0.53æ¢å¤)
   - Epoch 2: mAP â‰¥ 0.580 (æ¥è¿‘æœ€ä½³ç‚¹0.5884)

2. **Recallæ¢å¤**:
   - Epoch 1: Recall â‰¥ 0.70 (ä»0.645æ¢å¤)
   - Epoch 2: Recall â‰¥ 0.72

3. **æ£€æµ‹æ•°é‡å¢åŠ **:
   - Epoch 1: Dets â‰¥ 10000 (ä»8777æ¢å¤)
   - Epoch 2: Dets â‰¥ 11000

4. **è®­ç»ƒLossç¨³å®š**:
   - loss_totalä¿æŒåœ¨ 0.10-0.12
   - loss_clsä¸æ¿€å¢ (è¯´æ˜MACLæœªå¼•å…¥è¿‡å¤§æ‰°åŠ¨)

### âš ï¸ **éƒ¨åˆ†æˆåŠŸ** (éœ€ç»§ç»­è§‚å¯Ÿ)

- Epoch 2: mAPåœ¨ 0.55-0.58 ä¹‹é—´
- Recallåœ¨ 0.68-0.72 ä¹‹é—´
- Trendå‘ä¸Šä½†ç¼“æ…¢
- **è¡ŒåŠ¨**: ç»§ç»­è®­ç»ƒè‡³Epoch 4,è§‚å¯ŸLambdaå¢é•¿æ•ˆæœ

### âŒ **å¤±è´¥æ ‡å¿—** (éœ€ç´§æ€¥å¤„ç†)

1. **mAPç»§ç»­ä¸‹é™**:
   - Epoch 1: mAP < 0.53 (æ¯”èµ·ç‚¹æ›´å·®)
   - Epoch 2: mAP < 0.52

2. **Lossæ¿€å¢**:
   - loss_clsçªç„¶å¢åŠ  > 0.10 (MACLå†²çª)
   - loss_total > 0.20

3. **æ¢¯åº¦çˆ†ç‚¸**:
   - grad_norm > 15 (è¯´æ˜lrä»å¤ªé«˜)

## ğŸ”§ å¤±è´¥åçš„å¤‡é€‰æ–¹æ¡ˆ

### **Plan B.1: è¿›ä¸€æ­¥é™ä½å­¦ä¹ ç‡**

å¦‚æœEpoch 1-2å¤±è´¥,ä¿®æ”¹é…ç½®:
```python
optimizer=dict(
    type='AdamW',
    lr=5e-6,  # ä»1e-5è¿›ä¸€æ­¥å‡åŠ
    weight_decay=0.05
),
paramwise_cfg=dict(
    custom_keys={
        'backbone': dict(lr_mult=0.02)  # backbone=1e-7
    }
)
```

### **Plan B.2: ç¦ç”¨MACL,çº¯lrä¿®å¤**

å¦‚æœMACLå¼•å…¥ä¸ç¨³å®š:
```python
use_macl=False,  # å›åˆ°pure detection
lambda1=0.0,
# ä½†ä¿æŒè¶…ä½lr=1e-5
```

### **Plan B.3: å›åˆ°Stage1é‡æ–°é¢„è®­ç»ƒ**

å¦‚æœä»¥ä¸Šéƒ½å¤±è´¥:
- å¯èƒ½Stage1é¢„è®­ç»ƒåœ¨LLVIPä¸Šè´¨é‡ä¸è¶³
- éœ€è¦é‡æ–°å®¡è§†Stage1é…ç½®
- è€ƒè™‘å¢åŠ Stage1è®­ç»ƒepochs

## ğŸ“ˆ é¢„æœŸè®­ç»ƒæ—¶é—´

```
å•ä¸ªEpoch: ~50-55åˆ†é’Ÿ (11439 batches)
æ€»æ—¶é—´: 6 epochs Ã— 55åˆ†é’Ÿ = 5.5å°æ—¶

å…³é”®æ£€æŸ¥ç‚¹:
- 1å°æ—¶å: Epoch 1éªŒè¯å®Œæˆ (å†³å®šæ˜¯å¦ç»§ç»­)
- 2å°æ—¶å: Epoch 2éªŒè¯å®Œæˆ (ç¡®è®¤è¶‹åŠ¿)
- 3.5å°æ—¶å: Epoch 3-4éªŒè¯ (Lambdaå¢é•¿æ•ˆæœ)
- 5.5å°æ—¶å: è®­ç»ƒå®Œæˆ
```

## ğŸ¯ æœ€ç»ˆç›®æ ‡

**ä¸»ç›®æ ‡**: mAP â‰¥ 0.630 (Stage2.1åŸå§‹ç›®æ ‡)
**æ¬¡ç›®æ ‡**: mAP â‰¥ 0.600 (ç¨³å®šåœ¨Stage1æ°´å¹³é™„è¿‘)
**åº•çº¿**: mAP â‰¥ 0.580 (æ¢å¤åˆ°Epoch 2æœ€ä½³ç‚¹)

å¦‚æœè¾¾åˆ°ä¸»ç›®æ ‡ â†’ **Plan BæˆåŠŸ,ç»§ç»­Stage2.2**
å¦‚æœè¾¾åˆ°æ¬¡ç›®æ ‡ â†’ **éƒ¨åˆ†æˆåŠŸ,å¯èƒ½éœ€è¦è°ƒæ•´åç»­Stage**
å¦‚æœä»…è¾¾åˆ°åº•çº¿ â†’ **éœ€è¦é‡æ–°è¯„ä¼°æ•´ä½“è®­ç»ƒç­–ç•¥**

## ğŸ“ æ—¥å¿—å…³é”®è¯

è®­ç»ƒè¿‡ç¨‹ä¸­æœç´¢è¿™äº›å…³é”®è¯:
- `Progressive Lambda Update` - Lambdaè°ƒæ•´è®°å½•
- `pascal_voc/mAP:` - éªŒè¯mAP
- `grad_norm:` - æ¢¯åº¦èŒƒæ•° (æ£€æµ‹çˆ†ç‚¸/æ¶ˆå¤±)
- `loss_total:` - æ€»æŸå¤±
- `recall` - å¬å›ç‡
- `dets` - æ£€æµ‹æ¡†æ•°é‡

## â° ä¸‹ä¸€æ­¥è¡ŒåŠ¨æ—¶é—´è¡¨

| æ—¶é—´ç‚¹ | æ£€æŸ¥å†…å®¹ | å†³ç­– |
|--------|---------|------|
| **å¯åŠ¨å1å°æ—¶** | Epoch 1å®Œæˆ | mAPæ˜¯å¦>0.56? |
| **å¯åŠ¨å2å°æ—¶** | Epoch 2å®Œæˆ | ç¡®è®¤ä¸Šå‡è¶‹åŠ¿? |
| **å¯åŠ¨å3.5å°æ—¶** | Epoch 3-4å®Œæˆ | Lambdaå¢é•¿æ˜¯å¦æœ‰æ•ˆ? |
| **å¯åŠ¨å5.5å°æ—¶** | è®­ç»ƒå®Œæˆ | æ˜¯å¦è¾¾åˆ°ç›®æ ‡? |

---

**ç°åœ¨æ‰§è¡Œ**: 
```bash
python tools/train.py configs/llvip/stage2_1_kaist_planB_macl_rescue.py
```

**ç›‘æ§å‘½ä»¤å‡†å¤‡å°±ç»ª,ç­‰å¾…ä½ çš„å¯åŠ¨ç¡®è®¤! ğŸš€**
